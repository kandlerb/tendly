# Tendly Project Archive — 2026-02-20T14:00

## Project Overview
Tendly — a property management iOS app for small landlords and tenants. Built with Expo Router, NativeWind, Zustand, Supabase, Stripe, and Claude AI.

**Tech Stack:** Expo SDK 54, Expo Router v6, React Native 0.81.5, NativeWind v4.2.1, Zustand 5.0.11, Supabase JS v2.97.0, Stripe React Native v0.58.0, Claude claude-sonnet-4-6 via Supabase Edge Functions, EAS CLI.

## Current State
All screens and core features fully implemented. A comprehensive design-rules compliance audit (docs/Rules.md vs actual code) was completed, and Priority 1–3 remediation items were applied. Project now has accessibility labels, 48dp touch targets, breakpoints tokens, line-height tokens, ESLint quality gates in CI, platform-split alert module, StatusBar, and reduced landlord tab count (6→5 on mobile). App is ready for deployment pending manual infrastructure steps.

## Credentials
- Supabase URL/keys: `SupabaseInfo.txt` + `.env.local`
- Stripe keys: `StripeInfo.txt` + `.env.local`
- Anthropic key: `.env.local`
- Missing: `STRIPE_WEBHOOK_SECRET` (add after creating Stripe webhook endpoint)

## Code Map

### `app/`
| File | Purpose |
|------|---------|
| `_layout.tsx` | Root layout — Supabase auth listener, role+activeView-aware redirect; registers /profile modal; `<StatusBar style="dark" />` at root |
| `profile.tsx` | Profile modal — avatar initials, name edit, password change, admin view-switch, sign-out |
| `index.tsx` | Redirect to `/(auth)/login` |
| `(auth)/_layout.tsx` | Stack with no header |
| `(auth)/login.tsx` | Email/password login form |
| `(auth)/signup.tsx` | Landlord signup |
| `(landlord)/_layout.tsx` | 5-tab bar on mobile (Tend AI hidden via href:null), sidebar at ≥breakpoints.md; uses color tokens (no inline hex) |
| `(landlord)/profile-redirect.tsx` | Stub for tab redirect to /profile modal |
| `(landlord)/dashboard.tsx` | Portfolio stats + property summary; loading spinner; accessible stat card buttons; uses breakpoints.md |
| `(landlord)/tenants/index.tsx` | Tenants list + invite modal; autoFocus on email input when modal opens; full a11y labels; uses breakpoints.md |
| `(landlord)/tenants/[tenantId].tsx` | Tenant detail — 7 cards |
| `(landlord)/properties/index.tsx` | Property list; ActivityIndicator loading state; accessible add button (44×44); uses breakpoints.md |
| `(landlord)/properties/add.tsx` | Add property form |
| `(landlord)/properties/[id]/index.tsx` | Property detail |
| `(landlord)/maintenance/index.tsx` | Maintenance list |
| `(landlord)/maintenance/[id].tsx` | Maintenance detail |
| `(landlord)/messages/index.tsx` | Thread list |
| `(landlord)/messages/[threadId].tsx` | Realtime chat thread |
| `(landlord)/tend.tsx` | Tend AI streaming chat |
| `(landlord)/financials/index.tsx` | Per-property NOI |
| `(tenant)/_layout.tsx` | 4-tab bar on mobile + sidebar at ≥breakpoints.md; uses color tokens |
| `(tenant)/profile-redirect.tsx` | Stub for tab redirect |
| `(tenant)/pay.tsx` | Payment history |
| `(tenant)/maintenance.tsx` | Submit request with photo picker; accessible photo button; uses breakpoints.md |
| `(tenant)/messages.tsx` | Tenant-side chat |
| `(tenant)/documents.tsx` | Documents grouped by type; full a11y on view/acknowledge/upload buttons; uses breakpoints.md |
| `(tenant)/onboarding.tsx` | Deep-link invite landing |

### `store/`
| File | Exports |
|------|---------|
| `auth.ts` | `useAuthStore` — user, session, loading, activeView, fetchUser, setSession, setUser, setActiveView, signOut |
| `properties.ts` | `usePropertiesStore` — properties[], loading, fetchProperties, addProperty, addUnit, checkDeleteProperty, deleteProperty, error |
| `maintenance.ts` | `useMaintenanceStore` — requests[], loading, fetchRequests, updateRequest |
| `messages.ts` | `useMessagesStore` — threads[], messages{}, unreadCounts{}, fetchThreads, fetchMessages, sendMessage, markAsRead, subscribeToMessages |
| `tenants.ts` | `useTenantsStore` — tenants[], invitations[], fetchTenants, fetchInvitations, terminateLease |

### `lib/`
| File | Exports |
|------|---------|
| `theme.ts` | `colors`, `text`, `lineHeights`, `radius`, `shadow`, `spacing` (with xs/sm/md/lg/xl/2xl scale), `breakpoints` (md:768, lg:1024), `cardBase`, `headerBase` |
| `alert.ts` | Fallback (Platform.OS conditional) — kept for environments where neither `.native.ts` nor `.web.ts` are selected |
| `alert.native.ts` | Native-only: `showAlert`, `showConfirm` via Alert.alert (no runtime Platform check) |
| `alert.web.ts` | Web-only: `showAlert`, `showConfirm` via window.alert/confirm (no runtime Platform check) |
| `supabase.ts` | `supabase` client with ExpoSecureStoreAdapter |
| `utils.ts` | `formatCents`, `dollarsToCents`, `formatDate`, `calcCapRate` |
| `claude.ts` | `callTriage`, `callDraftMessage`, `inviteTenant`, `getSignedUrl`, `acknowledgeDocument` |
| `__tests__/utils.test.ts` | 3 passing unit tests |

### `components/`
| File | Exports |
|------|---------|
| `ui/Button.tsx` | `Button` — `accessibilityRole="button"`, `accessibilityLabel` prop (falls back to title), `accessibilityState.disabled`, `minHeight:48` |
| `ui/Input.tsx` | `Input` — `accessibilityLabel` forwarded, error has `accessibilityRole="alert"`, `minHeight:48` on input |
| `ui/PaywallGate.tsx` | `PaywallGate` |
| `ui/KeyboardView.tsx` | `KeyboardView` — web=View, native=KeyboardAvoidingView |
| `ui/SidebarLayout.tsx` | `SidebarLayout({ navItems })` — nav items have `minHeight:48`, `accessibilityRole="button"`, `accessibilityLabel`, `accessibilityState.selected`; profile/sign-out buttons also labeled |
| `domain/PropertyCard.tsx` | `PropertyCard` — `accessibilityRole="button"`, `accessibilityLabel` includes property name + unit count |
| `domain/MaintenanceBadge.tsx` | `UrgencyBadge`, `StatusBadge` |

### `supabase/`
| Path | Purpose |
|------|---------|
| `migrations/001_initial_schema.sql` | All 10 tables + RLS policies + 2 triggers |
| `migrations/002–005_*.sql` | is_admin, tenant management, documents, invitations |
| `functions/triage/index.ts` | Claude → JSON `{urgency, trade}` |
| `functions/tend/index.ts` | Claude streaming chat |
| `functions/draft-message/index.ts` | Claude → professional message draft |
| `functions/stripe-webhook/index.ts` | Stripe subscription sync |
| `functions/invite-tenant/index.ts` | Send invite email + create invitation record |
| `functions/complete-invitation/index.ts` | Consume token, create lease |
| `functions/get-signed-url/index.ts` | Generate signed URL for document |
| `functions/acknowledge-document/index.ts` | Stamp signed_by_tenant_at |

### `hooks/`
| File | Exports |
|------|---------|
| `useSubscription.ts` | `useSubscription` — subscription, isPaid, unitCount, atFreeLimit |

### `types/`
| File | Exports |
|------|---------|
| `index.ts` | User (+ is_admin), Property, Unit, Lease, RentPayment, MaintenanceRequest, Vendor, Message, Document, Subscription + enums |

### CI/Tooling
| File | Purpose |
|------|---------|
| `.github/workflows/deploy.yml` | `quality` job (type-check → lint → test) gates `deploy` job; deploy runs expo export + gh-pages publish |
| `eslint.config.js` | Flat config: `@typescript-eslint`, `eslint-plugin-react-native`; `no-color-literals: error`, `no-inline-styles: warn` |
| `package.json` | scripts: `lint`, `type-check`, `test` added; devDeps: `eslint`, `@typescript-eslint/eslint-plugin`, `@typescript-eslint/parser`, `eslint-plugin-react-native` |

## Open Compliance Items (Deferred)
- **Rule 15 (Dark mode)**: No dark token variants. Full effort; defer post-launch.
- **Rule 04 (Token hierarchy)**: Flat theme.ts is workable. Three-tier refactor is aspirational.
- **Rule 19 (Android back handler)**: No BackHandler on form screens. Add before Android launch.
- **Rule 33 (Bundle size CI)**: No size check in workflow. Add bundlephobia or expo stats step.
- **Rule 35 (Offline banner)**: Loading spinners + error surfacing added. Full offline banner requires `expo-network` install + root `_layout.tsx` banner component (not yet done).
- **Rule 14 (WCAG contrast)**: Unverified — run automated contrast audit before launch.

## Remaining Manual Steps
1. **Supabase migration** — paste `supabase/migrations/001_initial_schema.sql` into Supabase SQL Editor
2. **Storage bucket** — Supabase → Storage → New bucket: `documents` (private), `maintenance-photos` (public)
3. **Edge Function secrets** — set `ANTHROPIC_API_KEY`, `STRIPE_SECRET_KEY`, `STRIPE_WEBHOOK_SECRET`, `SUPABASE_SERVICE_ROLE_KEY`
4. **Deploy edge functions** — `npx supabase functions deploy triage tend draft-message stripe-webhook invite-tenant complete-invitation get-signed-url acknowledge-document`
5. **Stripe webhook** — add endpoint in Stripe dashboard, copy secret to `.env.local`
6. **EAS setup** — `eas init && eas build --profile development --platform ios`
7. **ESLint install** — `npm install` to pick up new devDependencies (eslint, @typescript-eslint/*, eslint-plugin-react-native)

## Change Log
| Timestamp | Files | Summary |
|-----------|-------|---------|
| 2026-02-18T21:00 | package.json, app.json, babel.config.js, tailwind.config.js, global.css, assets/ | Scaffolded Expo project, installed all deps, configured NativeWind + Jest |
| 2026-02-18T21:10 | types/index.ts | All domain types and enums |
| 2026-02-18T21:15 | supabase/migrations/001_initial_schema.sql, .env.local | DB schema with RLS + triggers; env file |
| 2026-02-18T21:25 | lib/supabase.ts, lib/utils.ts, lib/__tests__/utils.test.ts | Supabase client, utilities, 3 passing tests |
| 2026-02-18T21:35 | store/auth.ts, app/_layout.tsx, app/index.tsx, app/(auth)/*, components/ui/* | Auth store, root layout, login/signup, Button, Input |
| 2026-02-18T21:40 | app/(landlord)/* (stubs) | Tab layout with 5-tab bar, stub screens |
| 2026-02-18T21:50 | store/*, components/domain/*, app/(landlord)/* | Properties/maintenance/messages stores and full screens |
| 2026-02-18T22:00 | supabase/functions/*, lib/claude.ts, app/(landlord)/tend.tsx, hooks/, components/ui/PaywallGate.tsx, app/(tenant)/*, app/(landlord)/financials/* | All AI edge functions, Tend chat, subscription gate, full tenant app |
| 2026-02-19T10:00 | lib/theme.ts (NEW), all UI components + screens | Centralized theme token system; all components migrated |
| 2026-02-19T11:00–19:30 | All screens, lib/alert.ts, SidebarLayout, CI workflow | Web platform support, responsive layouts, auth screens, admin views, tenant management system (see previous archive for full detail) |
| 2026-02-20T14:00 | lib/theme.ts, lib/alert.native.ts (NEW), lib/alert.web.ts (NEW), components/ui/Button.tsx, components/ui/Input.tsx, components/ui/SidebarLayout.tsx, components/domain/PropertyCard.tsx, app/_layout.tsx, app/(landlord)/_layout.tsx, app/(tenant)/_layout.tsx, app/(landlord)/dashboard.tsx, app/(landlord)/properties/index.tsx, app/(landlord)/tenants/index.tsx, app/(tenant)/maintenance.tsx, app/(tenant)/documents.tsx, eslint.config.js (NEW), .eslintrc.json (NEW), package.json, .github/workflows/deploy.yml | Rules compliance remediation (Priority 1–3): (1) theme.ts — added breakpoints, lineHeights, xs/sm/md/lg/xl/2xl spacing scale, fixed 4 hardcoded hex strings in cardBase/headerBase; (2) UI components — accessibilityRole/label on all interactive elements, minHeight:48 on Button/Input/SidebarLayout nav items; (3) _layout files — StatusBar at root, landlord Tend AI tab hidden on mobile (6→5 tabs), inline color literals replaced with tokens; (4) all screens — breakpoints.md replaces hardcoded 768, ActivityIndicator loading states on dashboard+properties, a11y labels on all icon buttons, autoFocus on invite modal email input; (5) alert platform split into .native.ts/.web.ts; (6) ESLint config + lint/type-check/test scripts + CI quality gate job |
| 2026-02-20T21:00 | eslint.config.js, .eslintrc.json, package.json (lint script), tsconfig.json | ESLint install fix: ESLint 8.57 auto-detects eslint.config.js and uses flat-config mode, making --ext invalid — restored proper flat config in eslint.config.js (files glob replaces --ext); downgraded from ^9 to ^8.57.0 for eslint-plugin-react-native peer compat; excluded supabase/functions from tsconfig to silence Deno-specific type errors. All three CI scripts now pass: 0 type errors, 0 lint errors (110 warnings), tests wired. |
