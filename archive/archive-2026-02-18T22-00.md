# Tendly Project Archive — 2026-02-18T22:00

## Project Overview
Tendly — a property management iOS app for small landlords. Built from zero to TestFlight-ready per the implementation plan at `docs/plans/2026-02-18-tendly-implementation.md`.

**Tech Stack:** Expo SDK 54, Expo Router v6, NativeWind v4, Zustand, Supabase JS v2, Stripe React Native SDK, Claude claude-sonnet-4-6 via Supabase Edge Functions, EAS CLI.

## Current State
All 19 plan tasks complete. App is fully scaffolded and ready for: (1) Supabase migration run, (2) Edge Function deployment, (3) `npx expo start --ios` smoke test.

## Credentials
- Supabase URL/keys: `SupabaseInfo.txt` + `.env.local`
- Stripe keys: `StripeInfo.txt` + `.env.local`
- Anthropic key: `.env.local`
- Missing: `STRIPE_WEBHOOK_SECRET` (add after creating Stripe webhook endpoint)

## Code Map

### `app/`
| File | Purpose |
|------|---------|
| `_layout.tsx` | Root layout — Supabase auth listener, redirect logic (unauthed→login, authed+in-auth→dashboard) |
| `index.tsx` | Redirect to `/(auth)/login` |
| `(auth)/_layout.tsx` | Stack with no header |
| `(auth)/login.tsx` | Email/password login form |
| `(auth)/signup.tsx` | Landlord signup (sends role+name metadata to Supabase) |
| `(landlord)/_layout.tsx` | 5-tab bar: Home, Properties, Maintenance, Messages, Tend AI |
| `(landlord)/dashboard.tsx` | Portfolio stats (units, monthly rent, open requests, emergencies) + property summary |
| `(landlord)/properties/index.tsx` | Property list with PropertyCard; + button navigates to add |
| `(landlord)/properties/add.tsx` | Add property form (address, nickname, mortgage, unit count, rent) |
| `(landlord)/maintenance/index.tsx` | Maintenance list with urgency+status badges |
| `(landlord)/maintenance/[id].tsx` | Maintenance detail + status change buttons |
| `(landlord)/messages/index.tsx` | Thread list (one per active lease) |
| `(landlord)/messages/[threadId].tsx` | Realtime chat thread with AI-drafted indicator |
| `(landlord)/tend.tsx` | Tend AI chat — streams from `tend` edge function |
| `(landlord)/financials/index.tsx` | Per-property NOI breakdown (rent − mortgage − insurance − tax) |
| `(tenant)/_layout.tsx` | 3-tab bar: Pay Rent, Requests, Messages |
| `(tenant)/pay.tsx` | Payment history + pending payment card |
| `(tenant)/maintenance.tsx` | Submit request with photo picker + AI triage |
| `(tenant)/messages.tsx` | Tenant-side chat thread |

### `store/`
| File | Exports |
|------|---------|
| `auth.ts` | `useAuthStore` — user, session, loading, fetchUser, setSession, signOut |
| `properties.ts` | `usePropertiesStore` — properties[], fetchProperties, addProperty, addUnit |
| `maintenance.ts` | `useMaintenanceStore` — requests[], fetchRequests, updateRequest |
| `messages.ts` | `useMessagesStore` — threads[], messages{}, fetchThreads, fetchMessages, sendMessage, subscribeToMessages |

### `lib/`
| File | Exports |
|------|---------|
| `supabase.ts` | `supabase` client with SecureStore adapter |
| `utils.ts` | `formatCents`, `dollarsToCents`, `formatDate`, `calcCapRate` |
| `claude.ts` | `callTriage`, `callDraftMessage` |

### `components/`
| File | Exports |
|------|---------|
| `ui/Button.tsx` | `Button` (primary/secondary, loading state) |
| `ui/Input.tsx` | `Input` (label, error, all TextInput props) |
| `ui/PaywallGate.tsx` | `PaywallGate` (wraps content, shows upgrade CTA when locked) |
| `domain/PropertyCard.tsx` | `PropertyCard` (tap-to-navigate card) |
| `domain/MaintenanceBadge.tsx` | `UrgencyBadge`, `StatusBadge` |

### `supabase/`
| Path | Purpose |
|------|---------|
| `migrations/001_initial_schema.sql` | All 10 tables + RLS policies + 2 triggers |
| `functions/triage/index.ts` | Claude → JSON {urgency, trade} |
| `functions/tend/index.ts` | Claude streaming chat with portfolio context |
| `functions/draft-message/index.ts` | Claude → professional landlord message draft |
| `functions/stripe-webhook/index.ts` | Stripe subscription sync → subscriptions table |

### `hooks/`
| File | Exports |
|------|---------|
| `useSubscription.ts` | `useSubscription` — subscription, isPaid, unitCount, atFreeLimit |

### `types/`
| File | Exports |
|------|---------|
| `index.ts` | All domain types: User, Property, Unit, Lease, RentPayment, MaintenanceRequest, Vendor, Message, Document, Subscription + all enum types |

## Remaining Manual Steps
1. **Supabase migration** — paste `supabase/migrations/001_initial_schema.sql` into Supabase SQL Editor and run
2. **Storage bucket** — Supabase → Storage → New bucket: name=`documents`, public=No
3. **Edge Function secrets** — Supabase dashboard → Edge Functions → Secrets: set `ANTHROPIC_API_KEY`, `STRIPE_SECRET_KEY`, `STRIPE_WEBHOOK_SECRET`, `SUPABASE_SERVICE_ROLE_KEY`
4. **Deploy edge functions** — `npx supabase functions deploy triage tend draft-message stripe-webhook`
5. **Stripe webhook** — Add endpoint `https://zrfyvrwordbjgvpicdvq.supabase.co/functions/v1/stripe-webhook` in Stripe dashboard, then copy secret to `.env.local`
6. **EAS setup** — `eas init && eas build --profile development --platform ios`

## Change Log
| Timestamp | Files | Summary |
|-----------|-------|---------|
| 2026-02-18T21:00 | package.json, app.json, babel.config.js, tailwind.config.js, global.css, assets/ | Scaffolded Expo project, installed all deps, configured NativeWind + Jest |
| 2026-02-18T21:10 | types/index.ts | All domain types and enums |
| 2026-02-18T21:15 | supabase/migrations/001_initial_schema.sql, .env.local | DB schema with RLS + triggers; env file with all credentials |
| 2026-02-18T21:25 | lib/supabase.ts, lib/utils.ts, lib/__tests__/utils.test.ts | Supabase client, utility functions, 3 passing tests |
| 2026-02-18T21:35 | store/auth.ts, app/_layout.tsx, app/index.tsx, app/(auth)/*, components/ui/* | Auth store, root layout, login/signup screens, Button, Input |
| 2026-02-18T21:40 | app/(landlord)/* (stubs) | Tab layout with 5-tab bar, stub screens |
| 2026-02-18T21:50 | store/properties.ts, store/maintenance.ts, store/messages.ts, components/domain/*, app/(landlord)/properties/*, app/(landlord)/maintenance/*, app/(landlord)/messages/* | Properties/maintenance/messages stores and full screens |
| 2026-02-18T22:00 | supabase/functions/*, lib/claude.ts, app/(landlord)/tend.tsx, hooks/useSubscription.ts, components/ui/PaywallGate.tsx, app/(landlord)/dashboard.tsx, app/(tenant)/*, app/(landlord)/financials/* | All AI edge functions, Tend chat, subscription gate, full dashboard, full tenant app, financials screen |
