# Tendly Project Archive — 2026-02-19T10:00

## Project Overview
Tendly — a property management iOS app for small landlords and tenants. Built with Expo Router, NativeWind, Zustand, Supabase, Stripe, and Claude AI.

**Tech Stack:** Expo SDK 54, Expo Router v6, React Native 0.81.5, NativeWind v4.2.1, Zustand 5.0.11, Supabase JS v2.97.0, Stripe React Native v0.58.0, Claude claude-sonnet-4-6 via Supabase Edge Functions, EAS CLI.

## Current State
All screens and core features are fully implemented. A centralized theme system (`lib/theme.ts`) has been added since the last archive, and all UI components/screens now import from it. The `App.tsx` root file has been removed in favor of Expo Router's file-based routing. App is ready for deployment steps: Supabase migration, edge function deploy, Stripe webhook, and EAS build.

## Credentials
- Supabase URL/keys: `SupabaseInfo.txt` + `.env.local`
- Stripe keys: `StripeInfo.txt` + `.env.local`
- Anthropic key: `.env.local`
- Missing: `STRIPE_WEBHOOK_SECRET` (add after creating Stripe webhook endpoint)

## Code Map

### `app/`
| File | Purpose |
|------|---------|
| `_layout.tsx` | Root layout — Supabase auth listener, redirect logic (unauthed→login, authed+in-auth→dashboard) |
| `index.tsx` | Redirect to `/(auth)/login` |
| `(auth)/_layout.tsx` | Stack with no header |
| `(auth)/login.tsx` | Email/password login form; imports `colors`, `text` from `lib/theme.ts` |
| `(auth)/signup.tsx` | Landlord signup (sends role+name metadata to Supabase); imports theme tokens |
| `(landlord)/_layout.tsx` | 5-tab bar: Home, Properties, Maintenance, Messages, Tend AI |
| `(landlord)/dashboard.tsx` | Portfolio stats (units, monthly rent, open requests, emergencies) + property summary; uses theme tokens |
| `(landlord)/properties/index.tsx` | Property list with PropertyCard; + button navigates to add |
| `(landlord)/properties/add.tsx` | Add property form — split address (street/city/state/zip) with Nominatim validation, nickname, mortgage, unit count, rent; router.replace on success |
| `(landlord)/properties/[id]/index.tsx` | Property detail — address card, monthly financials (rent/mortgage/NOI), units list, delete button with safety checks |
| `(landlord)/maintenance/index.tsx` | Maintenance list with urgency+status badges |
| `(landlord)/maintenance/[id].tsx` | Maintenance detail + status change buttons (assign/resolve) |
| `(landlord)/messages/index.tsx` | Thread list (one per active lease) |
| `(landlord)/messages/[threadId].tsx` | Realtime chat thread with AI-drafted indicator (Sparkles icon) |
| `(landlord)/tend.tsx` | Tend AI chat — streams from `tend` edge function with portfolio context |
| `(landlord)/financials/index.tsx` | Per-property NOI breakdown (rent − mortgage − insurance − tax) |
| `(tenant)/_layout.tsx` | 3-tab bar: Pay Rent, Requests, Messages |
| `(tenant)/pay.tsx` | Payment history + pending payment card |
| `(tenant)/maintenance.tsx` | Submit request with photo picker + AI triage (urgency/trade) |
| `(tenant)/messages.tsx` | Tenant-side chat thread |

### `store/`
| File | Exports |
|------|---------|
| `auth.ts` | `useAuthStore` — user, session, loading, fetchUser, setSession, signOut |
| `properties.ts` | `usePropertiesStore` — properties[], fetchProperties, addProperty, addUnit, checkDeleteProperty, deleteProperty, error |
| `maintenance.ts` | `useMaintenanceStore` — requests[], fetchRequests, updateRequest |
| `messages.ts` | `useMessagesStore` — threads[], messages{}, fetchThreads, fetchMessages, sendMessage, subscribeToMessages |

### `lib/`
| File | Exports |
|------|---------|
| `theme.ts` | `colors`, `text`, `radius`, `shadow` — centralized design tokens (Tailwind-inspired palette, typography scale, border radius, shadow definitions) |
| `supabase.ts` | `supabase` client with ExpoSecureStoreAdapter |
| `utils.ts` | `formatCents`, `dollarsToCents`, `formatDate`, `calcCapRate` |
| `claude.ts` | `callTriage`, `callDraftMessage` — invoke Supabase edge functions |
| `__tests__/utils.test.ts` | 3 passing unit tests for utils |

### `components/`
| File | Exports |
|------|---------|
| `ui/Button.tsx` | `Button` (primary/secondary, loading state) — uses theme tokens |
| `ui/Input.tsx` | `Input` (label, error, all TextInput props) — uses theme tokens |
| `ui/PaywallGate.tsx` | `PaywallGate` (wraps content, shows upgrade CTA when locked) |
| `ui/KeyboardView.tsx` | `KeyboardView` — web renders plain View, native renders KeyboardAvoidingView with ios/height behavior |
| `ui/SidebarLayout.tsx` | `SidebarLayout` — 220px sidebar with brand + 6 nav items + Slot content area; uses useSegments for active highlight |
| `domain/PropertyCard.tsx` | `PropertyCard` (tap-to-navigate card) — uses theme tokens |
| `domain/MaintenanceBadge.tsx` | `UrgencyBadge`, `StatusBadge` — uses theme tokens |

### `lib/`
| File | Exports |
|------|---------|
| `alert.ts` | `showAlert(title, message?)`, `showConfirm(title, message, onConfirm, confirmLabel?)` — window.alert/window.confirm on web, Alert.alert on native |

### `supabase/`
| Path | Purpose |
|------|---------|
| `migrations/001_initial_schema.sql` | All 10 tables + RLS policies + 2 triggers |
| `functions/triage/index.ts` | Claude → JSON `{urgency, trade}` |
| `functions/tend/index.ts` | Claude streaming chat with portfolio context |
| `functions/draft-message/index.ts` | Claude → professional landlord message draft |
| `functions/stripe-webhook/index.ts` | Stripe subscription sync → subscriptions table |

### `hooks/`
| File | Exports |
|------|---------|
| `useSubscription.ts` | `useSubscription` — subscription, isPaid, unitCount, atFreeLimit |

### `types/`
| File | Exports |
|------|---------|
| `index.ts` | User, Property, Unit, Lease, RentPayment, MaintenanceRequest, Vendor, Message, Document, Subscription + all enum types |

## Remaining Manual Steps
1. **Supabase migration** — paste `supabase/migrations/001_initial_schema.sql` into Supabase SQL Editor and run
2. **Storage bucket** — Supabase → Storage → New bucket: name=`documents`, public=No
3. **Edge Function secrets** — Supabase dashboard → Edge Functions → Secrets: set `ANTHROPIC_API_KEY`, `STRIPE_SECRET_KEY`, `STRIPE_WEBHOOK_SECRET`, `SUPABASE_SERVICE_ROLE_KEY`
4. **Deploy edge functions** — `npx supabase functions deploy triage tend draft-message stripe-webhook`
5. **Stripe webhook** — Add endpoint `https://zrfyvrwordbjgvpicdvq.supabase.co/functions/v1/stripe-webhook` in Stripe dashboard, then copy secret to `.env.local`
6. **EAS setup** — `eas init && eas build --profile development --platform ios`

## Change Log
| Timestamp | Files | Summary |
|-----------|-------|---------|
| 2026-02-18T21:00 | package.json, app.json, babel.config.js, tailwind.config.js, global.css, assets/ | Scaffolded Expo project, installed all deps, configured NativeWind + Jest |
| 2026-02-18T21:10 | types/index.ts | All domain types and enums |
| 2026-02-18T21:15 | supabase/migrations/001_initial_schema.sql, .env.local | DB schema with RLS + triggers; env file with all credentials |
| 2026-02-18T21:25 | lib/supabase.ts, lib/utils.ts, lib/__tests__/utils.test.ts | Supabase client, utility functions, 3 passing tests |
| 2026-02-18T21:35 | store/auth.ts, app/_layout.tsx, app/index.tsx, app/(auth)/*, components/ui/* | Auth store, root layout, login/signup screens, Button, Input |
| 2026-02-18T21:40 | app/(landlord)/* (stubs) | Tab layout with 5-tab bar, stub screens |
| 2026-02-18T21:50 | store/properties.ts, store/maintenance.ts, store/messages.ts, components/domain/*, app/(landlord)/properties/*, app/(landlord)/maintenance/*, app/(landlord)/messages/* | Properties/maintenance/messages stores and full screens |
| 2026-02-18T22:00 | supabase/functions/*, lib/claude.ts, app/(landlord)/tend.tsx, hooks/useSubscription.ts, components/ui/PaywallGate.tsx, app/(landlord)/dashboard.tsx, app/(tenant)/*, app/(landlord)/financials/* | All AI edge functions, Tend chat, subscription gate, full dashboard, full tenant app, financials screen |
| 2026-02-19T10:00 | lib/theme.ts (NEW), all UI components, all landlord+auth screens, store/properties.ts, babel.config.js, package.json | Added centralized theme token system; all components and screens migrated to use theme tokens; App.tsx removed (Expo Router handles root); error field added to properties store |
| 2026-02-19T11:00 | index.ts, lib/supabase.ts, lib/alert.ts (NEW), components/ui/KeyboardView.tsx (NEW), components/ui/SidebarLayout.tsx (NEW), app/(landlord)/_layout.tsx, app/(auth)/login.tsx, app/(auth)/signup.tsx, app/(landlord)/tend.tsx, app/(landlord)/messages/[threadId].tsx, app/(landlord)/maintenance/[id].tsx, app/(landlord)/properties/add.tsx, app/(tenant)/maintenance.tsx, app/(tenant)/messages.tsx, app.json, .github/workflows/deploy.yml (NEW), package.json | Added full web platform support: platform-aware Supabase storage (localStorage on web), cross-platform Alert shim, KeyboardAvoidingView shim, web image picker in tenant maintenance, responsive sidebar nav (≥768px) vs bottom tabs (<768px), static export config, GitHub Pages deploy workflow |
| 2026-02-19T11:30 | lib/supabase.ts | Fixed localStorage SSR crash: added `typeof localStorage !== 'undefined'` guards so Node.js pre-render pass returns null instead of throwing |
| 2026-02-19T12:00 | app/(auth)/login.tsx, app/(auth)/signup.tsx | Responsive auth screens: useWindowDimensions → gray-50 background + centered 440px card on desktop (≥768px), unchanged on mobile |
| 2026-02-19T12:30 | app/(landlord)/properties/[id]/index.tsx (NEW), app/_layout.tsx, lib/theme.ts, app/(landlord)/tend.tsx, app/(landlord)/messages/[threadId].tsx | Created missing property detail screen (address, financials, units list); fixed auth redirect guard with initialized state; fixed shadow* deprecation with Platform.select boxShadow on web; removed disabled prop from TouchableOpacity send buttons to fix pointerEvents warning |
| 2026-02-19T13:00 | lib/alert.ts, store/properties.ts, app/(landlord)/properties/[id]/index.tsx | Added showConfirm utility; added checkDeleteProperty (active lease + open maintenance checks) and deleteProperty to properties store; added delete button to property detail screen with two-step safety check → confirm dialog → delete flow |
| 2026-02-19T13:30 | components/ui/Button.tsx, app/(landlord)/properties/add.tsx | Fixed Button pointerEvents warning (onPress=undefined instead of disabled prop); fixed GO_BACK crash (router.replace instead of router.back); split address into street/city/state/zip fields; added Nominatim geocoding validation before save |
